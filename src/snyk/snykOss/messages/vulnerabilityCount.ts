import {
  ModuleVulnerabilityCount,
  ModuleVulnerabilityCountSeverity,
} from '../services/vulnerabilityCount/importedModule';

export const messages = {
  fetchingVulnerabilities: 'Fetching vulnerabilities...',

  decoratorMessage: (vulnerabilityCount: number): string =>
    vulnerabilityCount > 1 ? 'vulnerabilities' : 'vulnerability',
  diagnosticMessage: (module: ModuleVulnerabilityCount): string => {
    if (!module.count || !module.severityCounts) {
      return '';
    }

    let message = `Dependency ${module.name}${module.version ? `@${module.version}` : ''} has `;
    message += getSeverityCountMessage(
      [
        ModuleVulnerabilityCountSeverity.Critical,
        ModuleVulnerabilityCountSeverity.High,
        ModuleVulnerabilityCountSeverity.Medium,
        ModuleVulnerabilityCountSeverity.Low,
      ],
      module,
    );
    message += module.count > 1 ? ' vulnerabilities.' : ' vulnerability.';

    return message;
  },
};

function getSeverityCountMessage(
  severities: ModuleVulnerabilityCountSeverity[],
  module: ModuleVulnerabilityCount,
): string {
  if (!module.severityCounts) {
    return '';
  }

  const content: string[] = [];
  for (const severity of severities) {
    if (module.severityCounts[severity] > 0) {
      content.push(`${module.severityCounts[severity]} ${severity}`);
    }
  }

  return content.join(', ');
}
